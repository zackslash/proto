syntax = "proto3";

package fortifi;

import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";
import "organisations.proto";

enum DomainServiceType {
    DS_CUSTOMER = 0;
    DS_COMMUNICATION = 1;
    DS_SUPPORT = 2;
    DS_CHAT = 3;
}

enum SoftwareInstallAction {
    SIA_INSTALL = 0;
    SIA_UNINSTALL = 1;
    SIA_UPGRADE = 2;
    SIA_REINSTALL = 3;
}

enum Direction {
    INBOUND = 0;
    OUTBOUND = 1;
    BI_DIRECTIONAL = 2;
}

enum CommunicationMethod {
    CM_EMAIL = 0;
    CM_PHONE = 1;
    CM_SMS = 2;
    CM_LETTER = 3;
    CM_MEETING = 4;
    CM_CHAT = 5;
    CM_PUSH = 6;
}

enum SubscriptionAction {
    SA_SUBSCRIBE = 0;
    SA_UNSUBSCRIBE = 1;
}

enum RateStyle {
    RS_ONE_FIVE = 0;//1-5
    RS_ONE_TEN = 1;//1-10
    RS_YES_NO = 2;//Y/N
    RS_ONE_THREE = 3;//1-3
    RS_ONE_HUNDRED = 4;//1-100
    RS_ZERO_HUNDRED = 5;//0-100
}

enum LinkType {
    LT_FOLLOW = 0;//Redirecting to another site
    LT_DOWNLOAD = 1;//Triggers a download, keeping user on the same page
}

enum OperatingSystem {
    OS_WINDOWS = 0;
    OS_OSX = 1;
    OS_LINUX = 2;
    OS_ANDROID = 3;
    OS_BLACKBERRY = 4;
    OS_IOS = 5;
    OS_FIREFOX_OS = 6;
    OS_CHROME_OS = 7;
    OS_WEB_OS = 8;
    OS_PALM_OS = 9;
    OS_SYMBIAN = 10;
    OS_TIZEN = 11;
    OS_BSD = 12;
}

enum DeviceType {
    DT_DESKTOP = 0;
    DT_TABLET = 1;
    DT_PHONE = 2;
    DT_TV = 3;
    DT_CAMERA = 4;
    DT_CAR = 5;
    DT_CONSOLE = 6;
    DT_MEDIA_PLAYER = 7;
    DT_GAME_CONSOLE = 8;
    DT_BOT = 9;
}

enum CampaignMedium {
    //Branding
    MED_PHONE = 0;
    MED_LETTER = 1;
    MED_EMAIL = 2;
    MED_SMS = 3;
    MED_DIRECT = 4;
    MED_ORGANIC_SEARCH = 5;
    MED_WORD_OF_MOUTH = 6;
    MED_REFERRAL = 7;

    //Paid Advertising
    MED_AFFILIATE = 8;
    MED_AFFILIATE_NETWORK = 9;
    MED_PAID_SEARCH = 10;
    MED_RETARGETTING = 11;
    MED_SOCIAL_ADVERT = 12;
    MED_INCENTIVE = 13;
    MED_REVIEW = 14;
    MED_BANNER = 15;

    //Generated Content
    MED_SOCIAL_MEDIA = 16;
    MED_WEBINAR = 17;
    MED_FORUM = 18;
    MED_VIDEO = 19;
    MED_PODCAST = 20;
    MED_RESEARCH_WHITEPAPER = 21;
    MED_BLOG = 22;
    MED_COMMENT_MARKETING = 23;
    MED_TESTIMONIAL = 24;
    MED_CASE_STUDY = 25;
    MED_EBOOK = 26;
    MED_HOW_TO_GUIDE = 27;
    MED_INFOGRAPHIC = 28;

    //Offline
    MED_TV = 29;
    MED_RADIO = 30;
    MED_BILLBOARD = 31;
    MED_NEWSPAPER = 32;
    MED_MAGAZINE = 33;
    MED_BROCHURE = 34;
    MED_PRINT_NEWSLETTER = 35;
    MED_FLYER = 36;
    MED_BUSINESS_CARD = 37;
    MED_DIRECTORY = 38;//e.g. Yellow Pages
    MED_COMPANY_SWAG = 39; // e.g. T-Shirts
}

enum AgreementAction {
    AA_CREATED = 0;
    AA_ACCEPTED = 1;
    AA_SUSPENDED = 2;
    AA_UNSUSPENDED = 3;
    AA_CANCELLED = 4;
    AA_RESTORED = 5;
    AA_TERMINATED = 6;
}

enum PaymentMethod {
    PM_CASH = 0;
    PM_DEBIT_CARD = 1;
    PM_CREDIT_CARD = 2;
    PM_PREPAID_CARD = 3;
    PM_CHEQUE = 4;
    PM_BANK_TRANSFER = 5;
    PM_STANDING_ORDER = 6;
    PM_DIRECT_DEBIT = 7;
    PM_DIGITAL_WALLET = 8; //e.g. PayPal, Apple Pay
    PM_MOBILE_PAYMENT = 9;
    PM_BITCOIN = 10;
    PM_COUPON = 11;
    PM_CREDIT = 12;
    PM_ACCOUNT_BALANCE = 13;
    PM_DIGITAL_STORE = 14; //e.g. Play Store, AppStore
}

enum ProductType {
    PRODUCT = 0;
    SERVICE = 1;
}

enum PurchaseType {
    PT_ITEM = 0;
    PT_ADDON = 1;
    PT_UPSELL = 2;
}

enum BillingCycleDay {
    BCD_SYNC_START = 0;//Progress by 1 month, would go no further than the 1st of the (+1 month) e.g. 31st Jan > 1st Mar
    BCD_SYNC_END = 1;//Progress by 1 month, would not go past the next month, and sync to the end, e.g. 31st Jan > 28th Feb, would remain on 28th Mar
    BCD_RESYNC_END = 2;//Same as sync end, but would sync back to the subscription start date, e.g. 31st Jan, 28th Feb, 31 Mar, 30 Apr
    BCD_SPECIFIC_DAY = 3;
    BCD_DAY_OF_WEEK = 4;
    BCD_MONTH_END = 5;
}

enum BillingCyclePeriod {
    BCP_NONE = 0;
    BCP_DAY = 1;
    BCP_WEEK = 2;
    BCP_MONTH = 3;
    BCP_YEAR = 4;
}

enum RefundType {
    RT_PARTIAL = 0;
    RT_FULL = 1;
}

enum RefundReason {
    RR_REQUESTED = 0;
    RR_DUPLICATE = 1;
    RR_FRAUDULENT = 2;
}

enum DisputeStatus {
    DS_OPEN = 0;
    DS_WON = 1;
    DS_LOST = 2;
}

enum DisputeReason {
    DR_FRAUDULENT = 0;
    DR_UNRECOGNIZED = 1;
}

enum CustomerAccountType {
    CAT_UNKNOWN = 0;
    CAT_RESIDENTIAL = 1;
    CAT_BUSINESS = 2;
    CAT_STUDENT = 3;
}

enum CustomerAccountStatus {
    CAS_INITIALISED = 0;
    CAS_SETUP = 1;
    CAS_ACTIVE = 2;
    CAS_SUSPENDED = 3;
    CAS_EXPIRED = 4;
    CAS_CANCELLED = 5;
}

enum CustomerLifecycle {
    CL_COLD = 0;//Provided details by a third party
    CL_SUBSCRIBER = 1;//Subscribed to a newsletter
    CL_CONTACTED = 2;//Contacted via some form
    CL_LEAD = 3;//Completed a product interest form e.g. more information about product
    CL_MARKETING_QUALIFIED_LEAD = 4;//Completed automated activities like viewing product demo
    CL_SALES_QUALIFIED_LEAD = 5;//Spoken to a sales rep for qualification
    CL_TRIAL = 6;// Subscribed for a trial account
    CL_FREE = 7;// Subscribed for a free account
    CL_OPPORTUNITY = 8;//Started Order Flow
    CL_CUSTOMER = 9;//Paying Customer
    CL_CANCELLED = 10;//Removed account (from paying)
    CL_LAPSED = 11;//Auto Cancelled
    CL_LOST = 12;//Removed account (From free)
}

enum CustomerOrientation {
    CO_UNKNOWN = 0;
    CO_COST = 1;//Focuses on least cost
    CO_VALUE = 2;//Focuses on value for money
    CO_TECHNOLOGY = 3;//Quality Product, Cost of less importance
    CO_BRAND = 4;//Will buy anything the brand sells
}

enum PurchaseStatus {
    PS_UNKNOWN = 0;
    PS_INTERESTED = 1;
    PS_CHECKOUT = 2;
    PS_SETUP = 3;
    PS_ACTIVE = 4;
    PS_INACTIVE = 5;
    PS_SUSPENDED = 6;
    PS_CANCELLED = 7;
    PS_ENDED = 8;
    PS_TRIAL = 9;
}

enum DomainTargetType {
    DTT_NONE = 0;
    DTT_COUNTRY = 1;
    DTT_LANGUAGE = 2;
    DTT_PRODUCT = 3;
    DTT_DEVELOPMENT = 4; //e.g. Serving alpha, beta etc
}

enum ServiceType {
    ST_EMAIL = 0;
    ST_SMS = 1;
    ST_URL_SHORTEN = 2;
    ST_PUSH = 3;//Push Notifications
    ST_STORAGE = 4;//Document Storage
    ST_TRANSLATE = 5;
}

enum TransactionType {
    TT_AUTH = 0;
    TT_CAPTURE_AUTH = 1;
    TT_CAPTURE = 2;
    TT_CREDIT = 3;
    TT_REFUND = 4;
    TT_VOID = 5;
    TT_DISPUTE = 6;
}

message BillingCycle {
    BillingCyclePeriod period = 1;
    int32 frequency = 2;//e.g. 6 for 6 month
    BillingCycleDay day = 3;
    string day_value = 4;//e.g. 3 for 3rd of month, 1 for Monday (based on day value)
}

message CampaignDetails {
    string source = 1;// Publisher ID, domain e.g. google.com
    string id = 2; //Campaign ID, Post ID etc
    CampaignMedium medium = 3;
}

message TrackingDetails {
    string id1 = 1;
    string id2 = 2;
    string id3 = 3;
    string id4 = 4;
    string id5 = 5;
}

message PurchasedItem {
    string product_code = 1;
    string sku = 2;
    string name = 3;
    int64 unit_price = 4;
    int32 quantity = 5;
    ProductType product_type = 6;
    PurchaseType purchase_type = 7;
    google.protobuf.Timestamp expiry = 8;
    google.protobuf.Timestamp start_date = 9;
    bool renews = 10;
}

// Core Entities

message Brand {
    string id = 1;
    string name = 2;
    string primary_domain = 3;
}

// - Customers

message Customer {
    string id = 1;
    string brand_id = 2;
    string account_number = 3;
    string display_name = 4;
    string email = 5;
    string phone = 6;
    string language = 7;
    string timezone = 8;
    string country = 9;
    CustomerAccountType account_type = 10;
    CustomerAccountStatus account_status = 11;
    CustomerLifecycle lifecycle = 12;
    CustomerOrientation orientation = 13;
    CampaignMedium source = 14;
    string source_value = 15;//e.g. google.com / publisher-id
    string parent_account = 16;
    string account_manager = 17;
}

message CustomerDates {
    string customer_id = 1;
    google.protobuf.Timestamp opened = 2;
    google.protobuf.Timestamp closed = 3;
    google.protobuf.Timestamp trial_start = 4;
    google.protobuf.Timestamp trial_end = 5;
    google.protobuf.Timestamp reopened = 6;
}

message CustomerFlags {
    string customer_id = 1;
    bool loyal = 2;//Loyal to brand
    bool vic = 3;//Very Important Customer
    bool fraud = 4;//Had fraud activity on account
    bool chargeback = 5;//Account has chargeback
    bool discount = 6;//Has purchased after offered discount
    bool impulse = 7;//Will buy on impulse
    bool test_account = 8;
    bool has_purchased = 9;//Has purchased anything
    bool renewing = 10;//Account is renewing
    bool at_risk = 11;//Usually unpaid bills, at risk of cancel
}

message CustomerBilling {
    string customer_id = 1;
    int64 balance = 2;
    bool is_delinquent = 3;
    int64 total_paid = 4;
    int64 total_refunded = 5;
    int64 total_chargeback = 6;
    int64 total_credited = 7;
    google.protobuf.Timestamp delinquent_since = 8;
}

message CustomerProductFeature {
    string customer_id = 1;
    string product_code = 2;
    string feature_code = 3;
    PurchaseStatus status = 4;
}

message CustomerProducts {
    repeated CustomerProductFeature products = 1;
}

// - Products

message Product {
    string id = 1;
    string name = 2;
    string group = 3;
    string code = 4;
    ProductType type = 5;
    string description = 6;
}

message ProductGroup {
    string id = 1;
    string name = 2;
    string description = 3;
}

message ProductFeature {
    string id = 1;
    string product_id = 2;
    string name = 3;
    string code = 4;
    string description = 5;
}

// - Domains

message DomainTarget {
    DomainTargetType type = 1;
    string value = 2; //e.g. en / en-GB / product-id / US
}

message Domain {
    string domain = 1;
    string brand_id = 2;
    repeated DomainTarget targets = 3;
    repeated DomainService services = 4;
}

message DomainService {
    string domain = 1;
    DomainServiceType service = 2;
    string subdomain = 3;
}

// - Services

message Service {
    string id = 1;
    Direction direction = 2;
    ServiceType service_type = 3;
    string service_provider = 4;
    string domain = 5;
    string name = 6;
    map<string,string> configuration = 7;
    bool is_default = 8;
}

// - Org Structure

message Member {
    string fident_id = 1;
    organisations.MemberType type = 2;
}

message Department {
    string id = 1;
    string name = 2;
}

// - Location

message GeoLocation {
    double longitude = 1;
    double latitude = 2;
    string continent = 3; //Europe, North America
    string sovereign_state = 4;//United Kingdom, United States
    string country = 5;//England, United States
    string region = 6; //South West
    string state = 7;//Devon, Arizona
    string borough = 8;//Torbay, Maricopa County
    string town = 9;//Paignton, Tempe
    string suburb = 10;//Preston, -
    string postal = 11;//TQ3 1, 85280
}

// - Finance

message FinanceTransaction {
    string transaction_id = 1;
    TransactionType type = 2;
    string currency = 3;
    int64 raw_amount = 4;
    int64 setup_amount = 5;
    int64 shipping_amount = 6;
    int64 discount_amount = 7;
    int64 setup_discount_amount = 8;
    int64 shipping_discount_amount = 9;
    int64 tax_amount = 10;
    int64 total_amount = 11;
    int64 total_discount_amount = 12;
    PaymentMethod payment_method = 13;
    string payment_method_detail = 14;//e.g. Visa, Mastercard, PayPal
    string gateway_id = 15;
    google.protobuf.Timestamp timestamp = 16;
}

// EVENTS

message EventDetail {
    google.protobuf.Timestamp timestamp = 1;
    string device_id = 2;
    string advcanced_device_id = 3;
    string app = 4;//domain / app-id
    string customer_id = 5;
    string ip = 6;
    map<string,string> meta = 7;
}

message ViewedEvent {
    EventDetail detail = 1;
    string entity = 2; //Either FID or Unique Item e.g. URL
}

message OpenedEvent {
    EventDetail detail = 1;
    string entity = 2; //Either FID or Unique Item e.g. URL
}

message ImpressionEvent {
    EventDetail detail = 1;
    CampaignDetails campaign = 2; //e.g. source=advertiser,id=campaign-id,medium=banner
    TrackingDetails tracking = 3;
    string creative = 4;//Banner ID
}

message LinkEvent {
    EventDetail detail = 1;
    CampaignDetails campaign = 2; //e.g. source=advertiser,id=campaign-id,medium=banner
    TrackingDetails tracking = 3;
    LinkType type = 4;
}

message ConversionEvent {
    EventDetail detail = 1;
    CampaignDetails campaign = 2; //e.g. source=advertiser,id=campaign-id,medium=banner
    TrackingDetails tracking = 3;
    FinanceTransaction transaction = 4;
    string action = 5;
}

message InstallationEvent {
    EventDetail detail = 1;
    CampaignDetails campaign = 2; //e.g. source=advertiser,id=campaign-id,medium=banner
    TrackingDetails tracking = 3;
    SoftwareInstallAction type = 4;
    string app_id = 5;
    string version = 6;
    OperatingSystem device_os = 7;
    DeviceType device_type = 8;
    string device_manufacturer = 9;//e.g. Apple, Microsoft, Samsung
    string device = 10;//e.g. iPad, Nexus 5, Laptop, Desktop
    string device_version = 11;
}

message CommunicationEvent {
    EventDetail detail = 1;
    Direction direction = 2;
    CommunicationMethod method = 3;
    string provider = 4;
    string initiator = 5;
    string receiver = 6;
    google.protobuf.Duration duration = 7;
    string subject = 8;
}

message SubscriptionEvent {
    EventDetail detail = 1;
    string entity = 2; //e.g. newsletter id
    SubscriptionAction action = 3;
}

message EntityRateEvent {
    EventDetail detail = 1;
    string entity = 2;
    RateStyle style = 3;
    string score = 4;
    bool positive = 5;//If the rating should be taken as a positive rating
}

message SignupEvent {
    EventDetail detail = 1;
    CampaignDetails campaign = 2; //e.g. source=advertiser,id=campaign-id,medium=banner
    TrackingDetails tracking = 3;
    string username = 4;
}

message SearchEvent {
    EventDetail detail = 1;
    string term = 2;
    string source = 3;//e.g. page or full url
    DomainService service = 4;
}

message ActionEvent {
    EventDetail detail = 1;
    string entity = 2; //e.g. Ticket / Video-ID / google.com
    string action = 3; //e.g. Created / Played / Logged In
}

message BillingAgreementEvent {
    EventDetail detail = 1;
    AgreementAction action = 2;
    int64 min_amount = 3;
    int64 max_amount = 4;
    PaymentMethod payment_method = 5;
    string payment_method_detail = 6;//e.g. Visa, Mastercard, PayPal
    string name = 7;
    string description = 8;
}

message PurchaseEvent {
    EventDetail detail = 1;
    CampaignDetails campaign = 2; //e.g. source=advertiser,id=campaign-id,medium=banner
    TrackingDetails tracking = 3;
    FinanceTransaction transaction = 4;
    map<string,PurchasedItem> items = 5;
}

message RefundEvent {
    EventDetail detail = 1;
    FinanceTransaction transaction = 2;
    FinanceTransaction charge_transaction = 3;
    RefundType type = 4;
    string reason = 5;
    RefundReason reason_type = 6;
}

message DisputeEvent {
    EventDetail detail = 1;
    DisputeStatus status = 2;
    FinanceTransaction transaction = 3;
    DisputeReason reason = 6;
}

message SocialEvent {
    EventDetail detail = 1;
    string network = 2;
    string action = 3; //e.g. Like / Share / Tweet
    string target = 4; //e.g. URL Liked
    string message = 5; //e.g. Tweet Content
}